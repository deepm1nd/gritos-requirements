# Deployment Guide: Requirements Management Web UI

This document provides instructions for deploying the backend and frontend components of the Requirements Management Web UI.

## 1. Backend Deployment (Node.js / Express)

The backend server handles API requests, interacts with the SQLite database, and manages Git operations for requirements.

### Prerequisites
*   Node.js (version 18.x or higher recommended)
*   npm (Node Package Manager)
*   Git (for version control of requirements files)
*   Access to the GitHub repository where requirements are stored (and a PAT for PR creation)
*   A pre-populated SQLite database (`requirements.sqlite`) generated by the `requirements-parser` tool.

### Setup & Deployment Steps

1.  **Clone the Repository:**
    ```bash
    git clone <repository_url>
    cd <repository_name>/requirements_web_backend
    ```
    (If deploying backend and frontend from the same main project, adjust paths accordingly).

2.  **Install Dependencies:**
    Navigate to the backend directory (`requirements_web_backend`) and install dependencies:
    ```bash
    npm install
    ```

3.  **Configure Environment Variables:**
    Create a `.env` file in the `requirements_web_backend` directory. This file stores sensitive configuration and API keys.
    ```env
    # .env (in requirements_web_backend)
    PORT=3000 # Port for the backend server

    # GitHub OAuth App credentials (for user login - if full OAuth flow is used for web app users)
    # These are distinct from the PAT used for Git operations by the backend itself.
    GITHUB_CLIENT_ID=YOUR_GITHUB_APP_CLIENT_ID
    GITHUB_CLIENT_SECRET=YOUR_GITHUB_APP_CLIENT_SECRET

    # GitHub Personal Access Token (PAT) for backend operations (creating branches, PRs)
    # Ensure this PAT has 'repo' scope for the requirements repository.
    GITHUB_TOKEN_PAT=YOUR_GITHUB_PERSONAL_ACCESS_TOKEN_WITH_REPO_SCOPE

    # GitHub repository details for storing requirements
    GITHUB_OWNER=your-github-username-or-org # Owner of the requirements repository
    GITHUB_REPO=product-requirements # Name of the requirements repository

    # JWT Secret Key for signing authentication tokens for frontend users
    JWT_SECRET=a_very_strong_and_random_secret_key_for_jwt

    # Frontend Base URL (for OAuth redirects and CORS if needed)
    WEBUI_BASE_URL=http://localhost:5173 # Or your deployed frontend URL

    # Path to the SQLite database file
    # This path should be relative to the backend server process or an absolute path.
    # Example: if docs_build is at project root, and server.js is in requirements_web_backend
    DATABASE_PATH=../docs_build/requirements.sqlite
    ```
    **Note:** Ensure `GITHUB_CLIENT_ID`, `GITHUB_CLIENT_SECRET`, `GITHUB_TOKEN_PAT`, `GITHUB_OWNER`, `GITHUB_REPO`, and `JWT_SECRET` are replaced with actual secure values for your deployment environment.

4.  **Start the Server:**
    ```bash
    node server.js
    ```
    Or, for production environments, use a process manager like PM2:
    ```bash
    pm2 start server.js --name "requirements-backend"
    ```

5.  **Verify:**
    The server should start, and you should see log output indicating it's listening on the configured `PORT` and has successfully connected to the database. Test API endpoints using a tool like Postman or `curl`.

## 2. Frontend Deployment (Preact / Vite)

The frontend is a Single Page Application (SPA) built with Preact and Vite. It requires building static assets which are then served by a web server (like Nginx, Apache, or a static hosting service).

### Prerequisites
*   Node.js (version 18.x or higher recommended, for building)
*   npm

### Setup & Deployment Steps

1.  **Build Static Assets:**
    Navigate to the frontend directory (`requirements_web_frontend`) and build the static assets:
    ```bash
    # Ensure all dependencies are installed
    npm install

    # Configure environment variables for the build process
    # Create or update .env file in requirements_web_frontend/
    # For production, VITE_API_BASE_URL must point to your deployed backend API.
    # VITE_GITHUB_CLIENT_ID and VITE_GITHUB_REDIRECT_URI also need to be set for production.
    ```
    Example `requirements_web_frontend/.env` for production build:
    ```env
    VITE_API_BASE_URL=https://your-deployed-backend.example.com/api
    VITE_GITHUB_CLIENT_ID=YOUR_GITHUB_APP_CLIENT_ID_FOR_PROD_FRONTEND_LOGIN
    VITE_GITHUB_REDIRECT_URI=https://your-deployed-frontend.example.com/auth/github/callback
    ```
    Then, run the build command:
    ```bash
    npm run build
    ```
    This command will generate a `dist/` directory within `requirements_web_frontend/` containing the optimized static assets (`index.html`, CSS, JavaScript bundles).

2.  **Deploy Static Assets:**
    Copy the contents of the `requirements_web_frontend/dist/` directory to your web server's document root or your static hosting service.

    **Example for Nginx:**
    If Nginx is your web server, configure a server block to serve these static files. Ensure proper configuration for SPA routing (i.e., all paths should serve `index.html` to let client-side routing take over).
    ```nginx
    server {
        listen 80;
        server_name your-frontend-domain.example.com;
        root /path/to/your/requirements_web_frontend/dist; # Path to the dist folder
        index index.html;

        location / {
            try_files $uri $uri/ /index.html; # Important for SPA routing
        }

        # Add other configurations like SSL, logs, etc.
    }
    ```

3.  **Environment Variable Note for Frontend (`VITE_API_BASE_URL`):**
    The `VITE_API_BASE_URL` environment variable used during the frontend build (`npm run build`) is compiled into the static assets. If your backend API URL changes, you will need to rebuild and redeploy the frontend assets with the updated `VITE_API_BASE_URL`.

### Known Issues
*   **Tailwind CSS Build:** As of the last build attempt, there was a persistent issue with the Tailwind CSS PostCSS plugin integration within the Vite build process. The build currently succeeds by commenting out Tailwind directives in `src/index.css` and removing `tailwindcss` from `postcss.config.cjs`. This means the deployed frontend will lack Tailwind styling. Further investigation is needed to resolve the Tailwind CSS build configuration in this specific environment.

## 3. General Considerations

*   **CORS:** Ensure the backend server's CORS policy is configured to allow requests from the frontend's domain, especially if they are hosted on different domains/ports.
*   **HTTPS:** For production, both frontend and backend should be served over HTTPS.
*   **Database Backups:** Regularly back up the `requirements.sqlite` database.
*   **Security:** Keep all dependencies updated and follow security best practices for Node.js applications and web server configuration. Review GitHub PAT permissions regularly.

This guide provides a baseline for deployment. Specific steps may vary based on your hosting environment and infrastructure.
